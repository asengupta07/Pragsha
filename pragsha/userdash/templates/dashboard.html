<!DOCTYPE html>
<html lang="en">
{% load pwa %}
{% load static %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        .card {
            background-color: #fff6ef;
        }

        body {
            background: -webkit-linear-gradient(to right, #ffffff, #ffb78f);
            background: linear-gradient(to right, #ffffff, #ffb78f);
        }

        .card-text {
            -webkit-line-clamp: 2;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-box-orient: vertical;
        }

        .form-control-root {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 300px;
            flex-wrap: wrap;
            flex-direction: row;
            border: 2px solid lightgray;
            padding: 4px;
            border-radius: 4px;
        }

        .container {
            gap: 6px;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
        }

        .container span {
            background-color: gray;
            padding: 1px 3px;
            border-radius: 4px;
        }

        /* Add styles for the close button icon */
        .chip {
            color: white;
            background-color: gray;
            padding: 1px 3px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            margin: 2px;
        }

        .close-button {
            cursor: pointer;
            margin-left: 4px;
        }

        ::-webkit-scrollbar {
            width: 5px;
            /* Adjust the width as needed */
        }

        ::-webkit-scrollbar-thumb {
            background: transparent;
            /* Make the thumb (the draggable part) invisible */
        }
        
        img {
			filter: drop-shadow(2px 2px 1px #000);
		}
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg sticky-top" style="background-color: #ffb78f;">
        <div class="container-fluid">
            <a  class="me-3" href="/"><img src="{% static 'wreath.png' %}" alt="logo" width="50px"></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item ms-3 me-3 text-center">
                        <a class="nav-link active" aria-current="page" href="#"><b>Home</b></a>
                    </li>
                    <li class="nav-item ms-3 me-3 text-center">
                        <a class="nav-link" href="#"><b>SOS</b></a>
                    </li>

                    <li class="nav-item dropdown ms-3 me-3 text-center">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <b>Resources</b>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item text-center href="#">Resource 1</a></li>
                            <li><a class="dropdown-item text-center" href="#">Another Resource</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item text-center" href="#">Resource Strikes Back</a></li>
                        </ul>
                    </li>
                </ul>
                <ul class="navbar-nav me-2">
                    <li class="nav-item ms-3 me-3 text-center">
                        <a class="nav-link" href="/user/logout"><b>Log Out</b></a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="modal fade" id="exampleModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Ask a Query!</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="recipient-name" class="col-form-label">Ask your Question:</label>
                            <input type="text" class="form-control" id="recipient-name">
                        </div>
                        <div class="mb-3">
                            <label for="message-text" class="col-form-label">Describe your question: <span
                                    style="float: right; color: grey;">&nbsp;&nbsp;&nbsp;[optional]</span></label>
                            <textarea class="form-control" id="message-text"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="recipient-name" class="col-form-label">Tags:</label>
                            <div class="container" id="chip-container" class="form-control"></div>
                            <input type="text" id="input" class="form-control" id="recipient-name"
                                oninput="handleChange(event)" onkeydown="handleKeyUp(event)">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Send message</button>
                </div>
            </div>
        </div>
    </div>
    <div class="card text-center" style="margin-left:10px; margin-right: 10px; margin-top: 20px;">
        <h1 class="card-header" style="text-align: left;">
            FORUM:
            <span style="float: right;">
                <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#exampleModal">Ask a
                    Query!</button>
            </span>
        </h1>
        <ul class="nav nav-tabs text-center">
            <li class="nav-item flex-fill">
                <a class="nav-link active" href="#">
                    <h4>Local Queries</h4>
                </a>
            </li>
            <li class="nav-item flex-fill">
                <a class="nav-link" href="#">
                    <h4>Your Queries</h4>
                </a>
            </li>
        </ul>
        <div class="queries">
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script>
        queries = document.querySelector(".queries");
        fetch('/user/get_queries')
            .then(response => {
                return response.json();
            })
            .then(data => {
                for (var i = 0; i < data.length; i++) {
                    var card = `<div class="card text-center" style="margin:20px;">
            <div class="card-header">
                <ul class="list-group list-group-horizontal" style="overflow-x: auto;">
                    <h5 class="card-header">
                        Tags:
                    </h5>`;
                    for (var j = 0; j < data[i].tags.length; j++) {
                        card += `<li class="list-group-item">${data[i].tags[j]}</li>`;
                    }
                card+=`</ul>
            </div>
            <div class="card-body" style="text-align: left;">
                <h4 class="card-title" style="text-align: left;">${data[i].question}
                </h4>
                <p class="card-text" style="text-align: left;">${data[i].description}</p>
                <a href="#" class="btn btn-dark">Check Answers <span class="badge text-bg-secondary">3</span></a>
            </div>
            <div class="card-footer text-body-secondary" style="text-align: right !important;">
                By <b>${data[i].author}</b> on <b>${data[i].timestamp}</b>
            </div>
        </div>`
                    queries.innerHTML += card;
                }
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
    </script>
    <script>
        nav = document.querySelectorAll(".nav-link");
        nav.forEach(element => {
            element.addEventListener("click", function () {
                nav.forEach(element => {
                    element.classList.remove("active");
                });
                element.classList.add("active");

            });
        });
    </script>
    <script>
        const chipContainer = document.getElementById('chip-container');
        const input = document.getElementById('input');
        let values = [];
        let currValue = '';

        function handleKeyUp(e) {
            if (e.keyCode === 32) {
                values.push(currValue); // Push the current value, not e.target.value
                currValue = ''; // Clear the input box
                input.value = ''; // Clear the input element's value
                renderChips();
            }
        }

        function handleChange(e) {
            currValue = e.target.value;
        }

        function renderChips() {
            chipContainer.innerHTML = '';
            values.forEach((item, index) => {
                const chip = document.createElement('span');
                chip.textContent = item;
                chip.classList.add('chip');

                // Create a close button icon
                const closeButton = document.createElement('span');
                closeButton.textContent = 'x';
                closeButton.classList.add('close-button');
                closeButton.addEventListener('click', () => handleDelete(index));

                chip.appendChild(closeButton);
                chipContainer.appendChild(chip);
            });
        }


        function handleDelete(index) {
            values.splice(index, 1);
            renderChips();
        }

        renderChips();

    </script>
</body>

</html>